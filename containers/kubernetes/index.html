<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="TL;DR (too long; didn't read) simple explanation of DevOps practices and tools, focused on practical examples. For " devops engineers&quot;, cloud engineers, platform engineer, site reliability engineers, etc.&quot;><meta name=author content=dumitrux><link href=https://dumitrux.github.io/tldr-devops/containers/kubernetes/ rel=canonical><link href=../docker/ rel=prev><link href=../../terraform/ rel=next><link rel=icon href=../../assets/images/favicon.ico><meta name=generator content="mkdocs-1.5.3, mkdocs-material-9.5.4"><title>Kubernetes - TL;DR DevOps</title><link rel=stylesheet href=../../assets/stylesheets/main.50c56a3b.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../stylesheets/extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><link href=../../assets/stylesheets/glightbox.min.css rel=stylesheet><style>
        html.glightbox-open { overflow: initial; height: 100%; }
        .gslide-title { margin-top: 0px; user-select: text; }
        .gslide-desc { color: #666; user-select: text; }
        .gslide-image img { background: white; }
        
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
            </style><script src=../../assets/javascripts/glightbox.min.js></script></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#kubernetes class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="TL;DR DevOps" class="md-header__button md-logo" aria-label="TL;DR DevOps" data-md-component=logo> <img src=../../assets/images/devops.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> TL;DR DevOps </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Kubernetes </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> </form> <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/dumitrux/tldr-devops title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> dumitrux/tldr-devops </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../linux/ class=md-tabs__link> Command line </a> </li> <li class=md-tabs__item> <a href=../../python/ class=md-tabs__link> Programming languages </a> </li> <li class=md-tabs__item> <a href=../../cicd/github-actions/ class=md-tabs__link> CI/CD </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../docker/ class=md-tabs__link> Containers </a> </li> <li class=md-tabs__item> <a href=../../terraform/ class=md-tabs__link> IaC </a> </li> <li class=md-tabs__item> <a href=../../azure/ class=md-tabs__link> Cloud Computing </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="TL;DR DevOps" class="md-nav__button md-logo" aria-label="TL;DR DevOps" data-md-component=logo> <img src=../../assets/images/devops.png alt=logo> </a> TL;DR DevOps </label> <div class=md-nav__source> <a href=https://github.com/dumitrux/tldr-devops title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> dumitrux/tldr-devops </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex> <span class=md-ellipsis> Command line </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Command line </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../linux/ class=md-nav__link> <span class=md-ellipsis> Linux </span> </a> </li> <li class=md-nav__item> <a href=../../bash/ class=md-nav__link> <span class=md-ellipsis> Bash </span> </a> </li> <li class=md-nav__item> <a href=../../vim/ class=md-nav__link> <span class=md-ellipsis> Vim </span> </a> </li> <li class=md-nav__item> <a href=../../powershell/ class=md-nav__link> <span class=md-ellipsis> PowerShell </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> Programming languages </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Programming languages </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../python/ class=md-nav__link> <span class=md-ellipsis> Python </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex> <span class=md-ellipsis> CI/CD </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> CI/CD </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../cicd/github-actions/ class=md-nav__link> <span class=md-ellipsis> GitHub Actions </span> </a> </li> <li class=md-nav__item> <a href=../../github-codespaces/ class=md-nav__link> <span class=md-ellipsis> GitHub Codespaces </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5 checked> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex> <span class=md-ellipsis> Containers </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=true> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Containers </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../docker/ class=md-nav__link> <span class=md-ellipsis> Docker </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Kubernetes </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Kubernetes </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#usefult-resources class=md-nav__link> <span class=md-ellipsis> Usefult resources </span> </a> </li> <li class=md-nav__item> <a href=#example class=md-nav__link> <span class=md-ellipsis> Example </span> </a> </li> <li class=md-nav__item> <a href=#1-creating-kubernetes-cluster-using-minikube class=md-nav__link> <span class=md-ellipsis> 1 - Creating Kubernetes cluster using Minikube </span> </a> <nav class=md-nav aria-label="1 - Creating Kubernetes cluster using Minikube"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#create-cluster class=md-nav__link> <span class=md-ellipsis> Create cluster </span> </a> </li> <li class=md-nav__item> <a href=#connect-to-cluster class=md-nav__link> <span class=md-ellipsis> Connect to cluster </span> </a> </li> <li class=md-nav__item> <a href=#exploring-with-kubectl class=md-nav__link> <span class=md-ellipsis> Exploring with Kubectl </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2-creating-just-single-pod class=md-nav__link> <span class=md-ellipsis> 2 - Creating just single Pod </span> </a> <nav class=md-nav aria-label="2 - Creating just single Pod"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#exploring-pod class=md-nav__link> <span class=md-ellipsis> Exploring Pod </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#3-creating-and-exploring-deployment class=md-nav__link> <span class=md-ellipsis> 3 - Creating and exploring Deployment </span> </a> <nav class=md-nav aria-label="3 - Creating and exploring Deployment"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#scale-deployment class=md-nav__link> <span class=md-ellipsis> Scale deployment </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#4-service class=md-nav__link> <span class=md-ellipsis> 4 - Service </span> </a> <nav class=md-nav aria-label="4 - Service"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#creating-and-exploring-clusterip-service class=md-nav__link> <span class=md-ellipsis> Creating and exploring ClusterIP Service </span> </a> </li> <li class=md-nav__item> <a href=#deleting-deployment-and-service class=md-nav__link> <span class=md-ellipsis> Deleting Deployment and Service </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#5-node-application-example class=md-nav__link> <span class=md-ellipsis> 5 - Node application example </span> </a> <nav class=md-nav aria-label="5 - Node application example"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#creating-node-web-application class=md-nav__link> <span class=md-ellipsis> Creating Node web application </span> </a> </li> <li class=md-nav__item> <a href=#dockerizing-node-application-and-pushing-custom-image-to-the-docker-hub class=md-nav__link> <span class=md-ellipsis> Dockerizing Node application and pushing custom image to the Docker Hub </span> </a> </li> <li class=md-nav__item> <a href=#creating-deployment-based-on-the-custom-docker-image class=md-nav__link> <span class=md-ellipsis> Creating deployment based on the custom Docker image </span> </a> </li> <li class=md-nav__item> <a href=#scaling-custom-image-deployment class=md-nav__link> <span class=md-ellipsis> Scaling custom image deployment </span> </a> </li> <li class=md-nav__item> <a href=#creating-nodeport-service class=md-nav__link> <span class=md-ellipsis> Creating NodePort Service </span> </a> </li> <li class=md-nav__item> <a href=#creating-loadbalancer-service class=md-nav__link> <span class=md-ellipsis> Creating LoadBalancer Service </span> </a> </li> <li class=md-nav__item> <a href=#rolling-update-of-the-deployment class=md-nav__link> <span class=md-ellipsis> Rolling update of the deployment </span> </a> </li> <li class=md-nav__item> <a href=#what-happens-when-one-of-the-pods-is-deleted class=md-nav__link> <span class=md-ellipsis> What happens when one of the pods is deleted </span> </a> </li> <li class=md-nav__item> <a href=#kubernetes-dashboard class=md-nav__link> <span class=md-ellipsis> Kubernetes Dashboard </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#6-node-application-example-with-yaml class=md-nav__link> <span class=md-ellipsis> 6 - Node application example with YAML </span> </a> <nav class=md-nav aria-label="6 - Node application example with YAML"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#creating-yaml-deployment-specification-file class=md-nav__link> <span class=md-ellipsis> Creating YAML deployment specification file </span> </a> </li> <li class=md-nav__item> <a href=#how-to-use-kubernetes-documentation class=md-nav__link> <span class=md-ellipsis> How to use Kubernetes documentation </span> </a> </li> <li class=md-nav__item> <a href=#applying-yaml-deployment-file class=md-nav__link> <span class=md-ellipsis> Applying YAML deployment file </span> </a> </li> <li class=md-nav__item> <a href=#creating-yaml-service-specification-file class=md-nav__link> <span class=md-ellipsis> Creating YAML service specification file </span> </a> </li> <li class=md-nav__item> <a href=#delete-all-created-by-the-yaml-files class=md-nav__link> <span class=md-ellipsis> Delete all created by the YAML files </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#7-ngninx-application-with-two-endpoints class=md-nav__link> <span class=md-ellipsis> 7 - Ngninx application with two endpoints </span> </a> <nav class=md-nav aria-label="7 - Ngninx application with two endpoints"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#creating-another-web-app-with-two-endpoints class=md-nav__link> <span class=md-ellipsis> Creating another web app with two endpoints </span> </a> </li> <li class=md-nav__item> <a href=#building-custom-docker-image-for-the-second-web-app class=md-nav__link> <span class=md-ellipsis> Building custom Docker image for the second web app </span> </a> </li> <li class=md-nav__item> <a href=#creating-yaml-specification-for-the-second-web-app class=md-nav__link> <span class=md-ellipsis> Creating YAML specification for the second web app </span> </a> </li> <li class=md-nav__item> <a href=#creating-yaml-specification-for-the-nginx-app class=md-nav__link> <span class=md-ellipsis> Creating YAML specification for the NGINX app </span> </a> </li> <li class=md-nav__item> <a href=#applying-specifications-for-both-apps class=md-nav__link> <span class=md-ellipsis> Applying specifications for both apps </span> </a> </li> <li class=md-nav__item> <a href=#verifying-connectivity-between-different-deployments class=md-nav__link> <span class=md-ellipsis> Verifying connectivity between different deployments </span> </a> </li> <li class=md-nav__item> <a href=#resolving-service-name-to-ip-address class=md-nav__link> <span class=md-ellipsis> Resolving Service name to IP address </span> </a> </li> <li class=md-nav__item> <a href=#deleting-both-applications class=md-nav__link> <span class=md-ellipsis> Deleting both applications </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#8-changing-container-runtime-from-docker-to-cri-o class=md-nav__link> <span class=md-ellipsis> 8 - Changing Container Runtime from Docker to CRI-O </span> </a> <nav class=md-nav aria-label="8 - Changing Container Runtime from Docker to CRI-O"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#deploying-apps-using-cri-o-container-runtime class=md-nav__link> <span class=md-ellipsis> Deploying apps using CRI-O container runtime </span> </a> </li> <li class=md-nav__item> <a href=#verifying-connectivity-between-deployments class=md-nav__link> <span class=md-ellipsis> Verifying connectivity between deployments </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex> <span class=md-ellipsis> IaC </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> IaC </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../terraform/ class=md-nav__link> <span class=md-ellipsis> Terraform </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex> <span class=md-ellipsis> Cloud Computing </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Cloud Computing </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../azure/ class=md-nav__link> <span class=md-ellipsis> Azure </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#usefult-resources class=md-nav__link> <span class=md-ellipsis> Usefult resources </span> </a> </li> <li class=md-nav__item> <a href=#example class=md-nav__link> <span class=md-ellipsis> Example </span> </a> </li> <li class=md-nav__item> <a href=#1-creating-kubernetes-cluster-using-minikube class=md-nav__link> <span class=md-ellipsis> 1 - Creating Kubernetes cluster using Minikube </span> </a> <nav class=md-nav aria-label="1 - Creating Kubernetes cluster using Minikube"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#create-cluster class=md-nav__link> <span class=md-ellipsis> Create cluster </span> </a> </li> <li class=md-nav__item> <a href=#connect-to-cluster class=md-nav__link> <span class=md-ellipsis> Connect to cluster </span> </a> </li> <li class=md-nav__item> <a href=#exploring-with-kubectl class=md-nav__link> <span class=md-ellipsis> Exploring with Kubectl </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2-creating-just-single-pod class=md-nav__link> <span class=md-ellipsis> 2 - Creating just single Pod </span> </a> <nav class=md-nav aria-label="2 - Creating just single Pod"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#exploring-pod class=md-nav__link> <span class=md-ellipsis> Exploring Pod </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#3-creating-and-exploring-deployment class=md-nav__link> <span class=md-ellipsis> 3 - Creating and exploring Deployment </span> </a> <nav class=md-nav aria-label="3 - Creating and exploring Deployment"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#scale-deployment class=md-nav__link> <span class=md-ellipsis> Scale deployment </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#4-service class=md-nav__link> <span class=md-ellipsis> 4 - Service </span> </a> <nav class=md-nav aria-label="4 - Service"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#creating-and-exploring-clusterip-service class=md-nav__link> <span class=md-ellipsis> Creating and exploring ClusterIP Service </span> </a> </li> <li class=md-nav__item> <a href=#deleting-deployment-and-service class=md-nav__link> <span class=md-ellipsis> Deleting Deployment and Service </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#5-node-application-example class=md-nav__link> <span class=md-ellipsis> 5 - Node application example </span> </a> <nav class=md-nav aria-label="5 - Node application example"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#creating-node-web-application class=md-nav__link> <span class=md-ellipsis> Creating Node web application </span> </a> </li> <li class=md-nav__item> <a href=#dockerizing-node-application-and-pushing-custom-image-to-the-docker-hub class=md-nav__link> <span class=md-ellipsis> Dockerizing Node application and pushing custom image to the Docker Hub </span> </a> </li> <li class=md-nav__item> <a href=#creating-deployment-based-on-the-custom-docker-image class=md-nav__link> <span class=md-ellipsis> Creating deployment based on the custom Docker image </span> </a> </li> <li class=md-nav__item> <a href=#scaling-custom-image-deployment class=md-nav__link> <span class=md-ellipsis> Scaling custom image deployment </span> </a> </li> <li class=md-nav__item> <a href=#creating-nodeport-service class=md-nav__link> <span class=md-ellipsis> Creating NodePort Service </span> </a> </li> <li class=md-nav__item> <a href=#creating-loadbalancer-service class=md-nav__link> <span class=md-ellipsis> Creating LoadBalancer Service </span> </a> </li> <li class=md-nav__item> <a href=#rolling-update-of-the-deployment class=md-nav__link> <span class=md-ellipsis> Rolling update of the deployment </span> </a> </li> <li class=md-nav__item> <a href=#what-happens-when-one-of-the-pods-is-deleted class=md-nav__link> <span class=md-ellipsis> What happens when one of the pods is deleted </span> </a> </li> <li class=md-nav__item> <a href=#kubernetes-dashboard class=md-nav__link> <span class=md-ellipsis> Kubernetes Dashboard </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#6-node-application-example-with-yaml class=md-nav__link> <span class=md-ellipsis> 6 - Node application example with YAML </span> </a> <nav class=md-nav aria-label="6 - Node application example with YAML"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#creating-yaml-deployment-specification-file class=md-nav__link> <span class=md-ellipsis> Creating YAML deployment specification file </span> </a> </li> <li class=md-nav__item> <a href=#how-to-use-kubernetes-documentation class=md-nav__link> <span class=md-ellipsis> How to use Kubernetes documentation </span> </a> </li> <li class=md-nav__item> <a href=#applying-yaml-deployment-file class=md-nav__link> <span class=md-ellipsis> Applying YAML deployment file </span> </a> </li> <li class=md-nav__item> <a href=#creating-yaml-service-specification-file class=md-nav__link> <span class=md-ellipsis> Creating YAML service specification file </span> </a> </li> <li class=md-nav__item> <a href=#delete-all-created-by-the-yaml-files class=md-nav__link> <span class=md-ellipsis> Delete all created by the YAML files </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#7-ngninx-application-with-two-endpoints class=md-nav__link> <span class=md-ellipsis> 7 - Ngninx application with two endpoints </span> </a> <nav class=md-nav aria-label="7 - Ngninx application with two endpoints"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#creating-another-web-app-with-two-endpoints class=md-nav__link> <span class=md-ellipsis> Creating another web app with two endpoints </span> </a> </li> <li class=md-nav__item> <a href=#building-custom-docker-image-for-the-second-web-app class=md-nav__link> <span class=md-ellipsis> Building custom Docker image for the second web app </span> </a> </li> <li class=md-nav__item> <a href=#creating-yaml-specification-for-the-second-web-app class=md-nav__link> <span class=md-ellipsis> Creating YAML specification for the second web app </span> </a> </li> <li class=md-nav__item> <a href=#creating-yaml-specification-for-the-nginx-app class=md-nav__link> <span class=md-ellipsis> Creating YAML specification for the NGINX app </span> </a> </li> <li class=md-nav__item> <a href=#applying-specifications-for-both-apps class=md-nav__link> <span class=md-ellipsis> Applying specifications for both apps </span> </a> </li> <li class=md-nav__item> <a href=#verifying-connectivity-between-different-deployments class=md-nav__link> <span class=md-ellipsis> Verifying connectivity between different deployments </span> </a> </li> <li class=md-nav__item> <a href=#resolving-service-name-to-ip-address class=md-nav__link> <span class=md-ellipsis> Resolving Service name to IP address </span> </a> </li> <li class=md-nav__item> <a href=#deleting-both-applications class=md-nav__link> <span class=md-ellipsis> Deleting both applications </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#8-changing-container-runtime-from-docker-to-cri-o class=md-nav__link> <span class=md-ellipsis> 8 - Changing Container Runtime from Docker to CRI-O </span> </a> <nav class=md-nav aria-label="8 - Changing Container Runtime from Docker to CRI-O"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#deploying-apps-using-cri-o-container-runtime class=md-nav__link> <span class=md-ellipsis> Deploying apps using CRI-O container runtime </span> </a> </li> <li class=md-nav__item> <a href=#verifying-connectivity-between-deployments class=md-nav__link> <span class=md-ellipsis> Verifying connectivity between deployments </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/dumitrux/tldr-devops/edit/master/docs/containers/kubernetes.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg> </a> <a href=https://github.com/dumitrux/tldr-devops/raw/master/docs/containers/kubernetes.md title="View source of this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.15 8.15 0 0 1-1.23-2Z"/></svg> </a> <h1 id=kubernetes><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m10.204 14.35.007.01-.999 2.413a5.171 5.171 0 0 1-2.075-2.597l2.578-.437.004.005a.44.44 0 0 1 .484.606zm-.833-2.129a.44.44 0 0 0 .173-.756l.002-.011L7.585 9.7a5.143 5.143 0 0 0-.73 3.255l2.514-.725.002-.009zm1.145-1.98a.44.44 0 0 0 .699-.337l.01-.005.15-2.62a5.144 5.144 0 0 0-3.01 1.442l2.147 1.523.004-.002zm.76 2.75.723.349.722-.347.18-.78-.5-.623h-.804l-.5.623.179.779zm1.5-3.095a.44.44 0 0 0 .7.336l.008.003 2.134-1.513a5.188 5.188 0 0 0-2.992-1.442l.148 2.615.002.001zm10.876 5.97-5.773 7.181a1.6 1.6 0 0 1-1.248.594l-9.261.003a1.6 1.6 0 0 1-1.247-.596l-5.776-7.18a1.583 1.583 0 0 1-.307-1.34L2.1 5.573c.108-.47.425-.864.863-1.073L11.305.513a1.606 1.606 0 0 1 1.385 0l8.345 3.985c.438.209.755.604.863 1.073l2.062 8.955c.108.47-.005.963-.308 1.34zm-3.289-2.057c-.042-.01-.103-.026-.145-.034-.174-.033-.315-.025-.479-.038-.35-.037-.638-.067-.895-.148-.105-.04-.18-.165-.216-.216l-.201-.059a6.45 6.45 0 0 0-.105-2.332 6.465 6.465 0 0 0-.936-2.163c.052-.047.15-.133.177-.159.008-.09.001-.183.094-.282.197-.185.444-.338.743-.522.142-.084.273-.137.415-.242.032-.024.076-.062.11-.089.24-.191.295-.52.123-.736-.172-.216-.506-.236-.745-.045-.034.027-.08.062-.111.088-.134.116-.217.23-.33.35-.246.25-.45.458-.673.609-.097.056-.239.037-.303.033l-.19.135a6.545 6.545 0 0 0-4.146-2.003l-.012-.223c-.065-.062-.143-.115-.163-.25-.022-.268.015-.557.057-.905.023-.163.061-.298.068-.475.001-.04-.001-.099-.001-.142 0-.306-.224-.555-.5-.555-.275 0-.499.249-.499.555l.001.014c0 .041-.002.092 0 .128.006.177.044.312.067.475.042.348.078.637.056.906a.545.545 0 0 1-.162.258l-.012.211a6.424 6.424 0 0 0-4.166 2.003 8.373 8.373 0 0 1-.18-.128c-.09.012-.18.04-.297-.029-.223-.15-.427-.358-.673-.608-.113-.12-.195-.234-.329-.349a2.691 2.691 0 0 0-.111-.088.594.594 0 0 0-.348-.132.481.481 0 0 0-.398.176c-.172.216-.117.546.123.737l.007.005.104.083c.142.105.272.159.414.242.299.185.546.338.743.522.076.082.09.226.1.288l.16.143a6.462 6.462 0 0 0-1.02 4.506l-.208.06c-.055.072-.133.184-.215.217-.257.081-.546.11-.895.147-.164.014-.305.006-.48.039-.037.007-.09.02-.133.03l-.004.002-.007.002c-.295.071-.484.342-.423.608.061.267.349.429.645.365l.007-.001.01-.003.129-.029c.17-.046.294-.113.448-.172.33-.118.604-.217.87-.256.112-.009.23.069.288.101l.217-.037a6.5 6.5 0 0 0 2.88 3.596l-.09.218c.033.084.069.199.044.282-.097.252-.263.517-.452.813-.091.136-.185.242-.268.399-.02.037-.045.095-.064.134-.128.275-.034.591.213.71.248.12.556-.007.69-.282v-.002c.02-.039.046-.09.062-.127.07-.162.094-.301.144-.458.132-.332.205-.68.387-.897.05-.06.13-.082.215-.105l.113-.205a6.453 6.453 0 0 0 4.609.012l.106.192c.086.028.18.042.256.155.136.232.229.507.342.84.05.156.074.295.145.457.016.037.043.09.062.129.133.276.442.402.69.282.247-.118.341-.435.213-.71-.02-.039-.045-.096-.065-.134-.083-.156-.177-.261-.268-.398-.19-.296-.346-.541-.443-.793-.04-.13.007-.21.038-.294-.018-.022-.059-.144-.083-.202a6.499 6.499 0 0 0 2.88-3.622c.064.01.176.03.213.038.075-.05.144-.114.28-.104.266.039.54.138.87.256.154.06.277.128.448.173.036.01.088.019.13.028l.009.003.007.001c.297.064.584-.098.645-.365.06-.266-.128-.537-.423-.608zM16.4 9.701l-1.95 1.746v.005a.44.44 0 0 0 .173.757l.003.01 2.526.728a5.199 5.199 0 0 0-.108-1.674A5.208 5.208 0 0 0 16.4 9.7zm-4.013 5.325a.437.437 0 0 0-.404-.232.44.44 0 0 0-.372.233h-.002l-1.268 2.292a5.164 5.164 0 0 0 3.326.003l-1.27-2.296h-.01zm1.888-1.293a.44.44 0 0 0-.27.036.44.44 0 0 0-.214.572l-.003.004 1.01 2.438a5.15 5.15 0 0 0 2.081-2.615l-2.6-.44-.004.005z"/></svg></span> Kubernetes</h1> <h2 id=usefult-resources>Usefult resources</h2> <ul> <li><a href=https://kodekloud.com/courses/certified-kubernetes-administrator-cka/ >KodeKloud | CKA Certification Course – Certified Kubernetes Administrator</a></li> <li><a href=https://editor.networkpolicy.io/ >Network Policy Editor for Kubernetes</a></li> <li><a href=https://learnk8s.io/kubernetes-instance-calculator>Kubernetes instance calculator</a></li> </ul> <h2 id=example>Example</h2> <p>Based on the example</p> <ul> <li><a href="https://www.youtube.com/watch?v=d6WC5n9G_sM">freeCodeCamp - Kubernetes Course - Full Beginners Tutorial</a></li> <li><a href=https://github.com/bstashchuk/k8s>GitHub repository for the "Kubernetes for Beginners"</a></li> </ul> <h2 id=1-creating-kubernetes-cluster-using-minikube>1 - Creating Kubernetes cluster using Minikube</h2> <h3 id=create-cluster>Create cluster</h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a>minikube<span class=w> </span>status
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>minikube<span class=w> </span>start<span class=w> </span>--driver<span class=o>=</span>hyperv
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>minikube<span class=w> </span>status
</span></code></pre></div> <h3 id=connect-to-cluster>Connect to cluster</h3> <p>Connect to local server with the standard protocol SSH.</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a>minikube<span class=w> </span>ip
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>ssh<span class=w> </span>docker@&lt;k8s-cluster-IP&gt;
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a>&gt;<span class=w> </span>tcuser
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a>docker<span class=w> </span>ps
</span></code></pre></div> <p>Minikube also provides command to SSH into local minikube node. If you set the driver to docker you should use this one because normal SSH will not work.</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a>minikube<span class=w> </span>ssh
</span></code></pre></div> <h3 id=exploring-with-kubectl>Exploring with Kubectl</h3> <p>Can only be exxecuted inside the cluster with:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a>minikube<span class=w> </span>kubectl
</span></code></pre></div> <p>But it is recommended to use the default kubctl outside the cluster. The connection is automatically created once Minikube is started.</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a>kubectl<span class=w> </span>cluster-info
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a>kubectl<span class=w> </span>get<span class=w> </span>nodes
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a>kubectl<span class=w> </span>get<span class=w> </span>pods
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a>kubectl<span class=w> </span>get<span class=w> </span>namespaces
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a>
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a>kubectl<span class=w> </span>get<span class=w> </span>pods<span class=w> </span>--namespace<span class=o>=</span>kube-system
</span></code></pre></div> <h2 id=2-creating-just-single-pod>2 - Creating just single Pod</h2> <p>Name of the Pod can be whatever and the image is from the Docker Hub.</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a>kubectl<span class=w> </span>run<span class=w> </span>nginx<span class=w> </span>--image<span class=o>=</span>nginx
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a>kubectl<span class=w> </span>get<span class=w> </span>pod
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a>kubectl<span class=w> </span>describe<span class=w> </span>pod<span class=w> </span>nginx
</span></code></pre></div> <h3 id=exploring-pod>Exploring Pod</h3> <p>Inside the cluster:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a>docker<span class=w> </span>ps<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>nginx
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a>docker<span class=w> </span><span class=nb>exec</span><span class=w> </span>-it<span class=w> </span>&lt;container-id&gt;<span class=w> </span>sh
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a>&gt;<span class=w> </span>hostname
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a>&gt;<span class=w> </span>hostname<span class=w> </span>-i
</span><span id=__span-6-5><a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a>&gt;<span class=w> </span>curl<span class=w> </span>&lt;container-ip&gt;
</span></code></pre></div> <p>Outside the cluster:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a>kubectl<span class=w> </span>get<span class=w> </span>pods<span class=w> </span>-o<span class=w> </span>wide
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a>curl<span class=w> </span><span class=m>172</span>.17.0.3
</span></code></pre></div> <p>Several container in the same Pod share the same IP. IP address is internal from the Pod and it is not possible to connect from outside.</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a>kubectl<span class=w> </span>delete<span class=w> </span>pod<span class=w> </span>nginx
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a>kubectl<span class=w> </span>get<span class=w> </span>pods
</span></code></pre></div> <h2 id=3-creating-and-exploring-deployment>3 - Creating and exploring Deployment</h2> <p>Deployments are responsible of the creation of the Pods. All pods inside the deployment will be exactly the same.</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a>kubectl<span class=w> </span>create<span class=w> </span>deployment<span class=w> </span>nginx-deployment<span class=w> </span>--image<span class=o>=</span>nginx
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a>kubectl<span class=w> </span>get<span class=w> </span>deployments
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a>kubectl<span class=w> </span>get<span class=w> </span>pods
</span><span id=__span-9-4><a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a>kubectl<span class=w> </span>describe<span class=w> </span>deployment<span class=w> </span>nginx-deployment
</span></code></pre></div> <h3 id=scale-deployment>Scale deployment</h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a>kubectl<span class=w> </span>scale<span class=w> </span>deployment<span class=w> </span>nginx-deployment<span class=w> </span>--replicas<span class=o>=</span><span class=m>5</span>
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a>kubectl<span class=w> </span>get<span class=w> </span>pods
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a>kubectl<span class=w> </span>get<span class=w> </span>pods<span class=w> </span>-o<span class=w> </span>wide
</span></code></pre></div> <div class="language-bash highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a>kubectl<span class=w> </span>scale<span class=w> </span>deployment<span class=w> </span>nginx-deployment<span class=w> </span>--replicas<span class=o>=</span><span class=m>3</span>
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a>kubectl<span class=w> </span>get<span class=w> </span>pods<span class=w> </span>-o<span class=w> </span>wide
</span></code></pre></div> <h2 id=4-service>4 - Service</h2> <h3 id=creating-and-exploring-clusterip-service>Creating and exploring ClusterIP Service</h3> <p>IP address assigned to deployment and it only can be used inside the cluster.</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a>kubectl<span class=w> </span>get<span class=w> </span>deploy
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a>kubectl<span class=w> </span>expose<span class=w> </span>deployment<span class=w> </span>nginx-deployment<span class=w> </span>--port<span class=o>=</span><span class=m>8080</span><span class=w> </span>--target-port<span class=o>=</span><span class=m>80</span>
</span><span id=__span-12-3><a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a>kubectl<span class=w> </span>get<span class=w> </span>services
</span><span id=__span-12-4><a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a>kubectl<span class=w> </span>get<span class=w> </span>svc
</span><span id=__span-12-5><a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a>kubectl<span class=w> </span>describe<span class=w> </span>service<span class=w> </span>nginx-deployment
</span></code></pre></div> <h3 id=deleting-deployment-and-service>Deleting Deployment and Service</h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a>kubectl<span class=w> </span>delete<span class=w> </span>deployment<span class=w> </span>nginx-deployment
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a>kubectl<span class=w> </span>delete<span class=w> </span>service<span class=w> </span>nginx-deployment
</span></code></pre></div> <h2 id=5-node-application-example>5 - Node application example</h2> <h3 id=creating-node-web-application>Creating Node web application</h3> <p>Set up node app</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a>New-Item<span class=w> </span>-Path<span class=w> </span>.<span class=w> </span>-Name<span class=w> </span><span class=s2>&quot;k8s-web-hello&quot;</span><span class=w> </span>-ItemType<span class=w> </span><span class=s2>&quot;directory&quot;</span>
</span><span id=__span-14-2><a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a>npm<span class=w> </span>init<span class=w> </span>-y
</span><span id=__span-14-3><a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a>npm<span class=w> </span>install<span class=w> </span>express
</span><span id=__span-14-4><a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a>Remove-Item<span class=w> </span>-Recurse<span class=w> </span>-Force<span class=w> </span>node_modules
</span><span id=__span-14-5><a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a>New-Item<span class=w> </span>-Path<span class=w> </span>.<span class=w> </span>-Name<span class=w> </span><span class=s2>&quot;index.mjs&quot;</span><span class=w> </span>-ItemType<span class=w> </span><span class=s2>&quot;file&quot;</span>
</span><span id=__span-14-6><a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a>Get-ChildItem
</span></code></pre></div> <h3 id=dockerizing-node-application-and-pushing-custom-image-to-the-docker-hub>Dockerizing Node application and pushing custom image to the Docker Hub</h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a>New-Item<span class=w> </span>-Path<span class=w> </span>.<span class=w> </span>-Name<span class=w> </span><span class=s2>&quot;Dockerfile&quot;</span><span class=w> </span>-ItemType<span class=w> </span><span class=s2>&quot;file&quot;</span>
</span><span id=__span-15-2><a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a>docker<span class=w> </span>build<span class=w> </span>.<span class=w> </span>-t<span class=w> </span>mitu7/k8s-web-hello
</span><span id=__span-15-3><a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a>docker<span class=w> </span>images<span class=w> </span><span class=p>|</span><span class=w> </span>Select-String<span class=w> </span>-Pattern<span class=w> </span>k8s-web
</span><span id=__span-15-4><a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a>docker<span class=w> </span>login
</span><span id=__span-15-5><a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a>&gt;<span class=w> </span>mitu7
</span><span id=__span-15-6><a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a>docker<span class=w> </span>push<span class=w> </span>mitu7/k8s-web-hello
</span></code></pre></div> <h3 id=creating-deployment-based-on-the-custom-docker-image>Creating deployment based on the custom Docker image</h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a>kubectl<span class=w> </span>get<span class=w> </span>deploy
</span><span id=__span-16-2><a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a>kubectl<span class=w> </span>get<span class=w> </span>svc
</span><span id=__span-16-3><a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a>kubectl<span class=w> </span>create<span class=w> </span>deployment<span class=w> </span>k8s-web-hello<span class=w> </span>--image<span class=o>=</span>mitu7/k8s-web-hello
</span><span id=__span-16-4><a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a>kubectl<span class=w> </span>get<span class=w> </span>pods
</span><span id=__span-16-5><a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a>kubectl<span class=w> </span>expose<span class=w> </span>deployment<span class=w> </span>k8s-web-hello<span class=w> </span>--port<span class=o>=</span><span class=m>3000</span>
</span></code></pre></div> <h3 id=scaling-custom-image-deployment>Scaling custom image deployment</h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a>kubectl<span class=w> </span>scale<span class=w> </span>deployment<span class=w> </span>k8s-web-hello<span class=w> </span>--replicas<span class=o>=</span><span class=m>4</span>
</span><span id=__span-17-2><a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a>kubectl<span class=w> </span>get<span class=w> </span>pods
</span><span id=__span-17-3><a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a>kubectl<span class=w> </span>get<span class=w> </span>pods<span class=w> </span>-o<span class=w> </span>wide
</span><span id=__span-17-4><a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a>
</span><span id=__span-17-5><a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a><span class=c1># Inside the cluster</span>
</span><span id=__span-17-6><a id=__codelineno-17-6 name=__codelineno-17-6 href=#__codelineno-17-6></a>curl<span class=w> </span>&lt;service-ClusterIP&gt;<span class=p>;</span><span class=w> </span><span class=nb>echo</span>
</span></code></pre></div> <h3 id=creating-nodeport-service>Creating NodePort Service</h3> <p>This service IP is avaiable externally</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a>kubectl<span class=w> </span>delete<span class=w> </span>svc<span class=w> </span>k8s-web-hello
</span><span id=__span-18-2><a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a>kubectl<span class=w> </span>get<span class=w> </span>svc
</span><span id=__span-18-3><a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a>kubectl<span class=w> </span>expose<span class=w> </span>deployment<span class=w> </span>k8s-web-hello<span class=w> </span>--type<span class=o>=</span>NodePort<span class=w> </span>--port<span class=o>=</span><span class=m>3000</span>
</span><span id=__span-18-4><a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a>kubectl<span class=w> </span>get<span class=w> </span>svc
</span><span id=__span-18-5><a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a>curl<span class=w> </span>&lt;Minikube-IP&gt;:&lt;Target<span class=w> </span>port&gt;
</span><span id=__span-18-6><a id=__codelineno-18-6 name=__codelineno-18-6 href=#__codelineno-18-6></a>minikube<span class=w> </span>service<span class=w> </span>k8s-web-hello
</span><span id=__span-18-7><a id=__codelineno-18-7 name=__codelineno-18-7 href=#__codelineno-18-7></a>minikube<span class=w> </span>service<span class=w> </span>k8s-web-hello<span class=w> </span>--url
</span></code></pre></div> <h3 id=creating-loadbalancer-service>Creating LoadBalancer Service</h3> <p>When creating the LoadBalancer service type in a Cloud environment, the External-IP will be assigned automatically here it is in state <code>&lt;pending&gt;</code>.</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a>kubectl<span class=w> </span>delete<span class=w> </span>svc<span class=w> </span>k8s-web-hello
</span><span id=__span-19-2><a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a>kubectl<span class=w> </span>expose<span class=w> </span>deployment<span class=w> </span>k8s-web-hello<span class=w> </span>--type<span class=o>=</span>LoadBalancer<span class=w> </span>--port<span class=o>=</span><span class=m>3000</span>
</span><span id=__span-19-3><a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a>minikube<span class=w> </span>service<span class=w> </span>k8s-web-hello
</span></code></pre></div> <h3 id=rolling-update-of-the-deployment>Rolling update of the deployment</h3> <p>The StrategyType is RollingUpdate, helps tou roll out new version of application to the production environment without any interruption. This strategy means that new Pods will be created with new image, while previous Pods are still running, so Pods will be replace one by one.</p> <p>Generate new image</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a>kubectl<span class=w> </span>describe<span class=w> </span>deployment<span class=w> </span>k8s-web-hello
</span><span id=__span-20-2><a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a>docker<span class=w> </span>build<span class=w> </span>.<span class=w> </span>-t<span class=w> </span>mitu7/k8s-web-hello:2.0.1
</span><span id=__span-20-3><a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a>docker<span class=w> </span>push<span class=w> </span>mitu7/k8s-web-hello:2.0.1
</span></code></pre></div> <p>Set new image for the deployment If you quickly execute the second command here, you will see how the Pods are being updated</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-21-1><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a>kubectl<span class=w> </span><span class=nb>set</span><span class=w> </span>image<span class=w> </span>deployment<span class=w> </span>k8s-web-hello<span class=w> </span>k8s-web-hello<span class=o>=</span>mitu7/k8s-web-hello:2.0.1
</span><span id=__span-21-2><a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a>kubectl<span class=w> </span>rollout<span class=w> </span>status<span class=w> </span>deploy<span class=w> </span>k8s-web-hello
</span></code></pre></div> <h3 id=what-happens-when-one-of-the-pods-is-deleted>What happens when one of the pods is deleted</h3> <p>If you delete a Pod a new one will be created automatically, because we told Kubernetes that the desire number of Pods</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-22-1><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a>kubectl<span class=w> </span>delete<span class=w> </span>pod<span class=w> </span>&lt;Pod-name&gt;
</span><span id=__span-22-2><a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a>kubectl<span class=w> </span>get<span class=w> </span>pods
</span></code></pre></div> <h3 id=kubernetes-dashboard>Kubernetes Dashboard</h3> <p>This is easy in Minikube, but in the Cloud it is needed to secure the net access</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-23-1><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a>minikube<span class=w> </span>dashboard
</span></code></pre></div> <h2 id=6-node-application-example-with-yaml>6 - Node application example with YAML</h2> <h3 id=creating-yaml-deployment-specification-file>Creating YAML deployment specification file</h3> <p>Instead of using imperative approach we will use declarative approach, which is more used.</p> <p>Clean up. Note that when deleting all the Kubernetes service is recreated again.</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-24-1><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a>kubectl<span class=w> </span>delete<span class=w> </span>all<span class=w> </span>--all
</span><span id=__span-24-2><a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a>kubectl<span class=w> </span>get<span class=w> </span>pods
</span><span id=__span-24-3><a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a>kubectl<span class=w> </span>get<span class=w> </span>svc<span class=w> </span>
</span><span id=__span-24-4><a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a>kubectl<span class=w> </span>get<span class=w> </span>deployments
</span></code></pre></div> <p>It is need to create a YAML file for deployment and another for service. If you have Kubernetes VSC extension and type "Deployment" the configuration basic file will be automatically created.</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-25-1><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a>New-Item<span class=w> </span>-Path<span class=w> </span>.<span class=w> </span>-Name<span class=w> </span><span class=s2>&quot;deployment.yaml&quot;</span><span class=w> </span>-ItemType<span class=w> </span><span class=s2>&quot;file&quot;</span>
</span></code></pre></div> <p><a href=https://github.com/bstashchuk/k8s/blob/main/deployment.yaml>deployment.yaml</a></p> <h3 id=how-to-use-kubernetes-documentation>How to use Kubernetes documentation</h3> <p><a href=https://kubernetes.io/docs/reference/kubernetes-api/ >Kubernetes API</a></p> <h3 id=applying-yaml-deployment-file>Applying YAML deployment file</h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-26-1><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a>kubectl<span class=w> </span>apply<span class=w> </span>-f<span class=w> </span>deployment.yaml
</span><span id=__span-26-2><a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a>kubectl<span class=w> </span>get<span class=w> </span>deploy
</span></code></pre></div> <p>Add "replicas" entry in deployment.yaml file</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-27-1><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a>kubectl<span class=w> </span>apply<span class=w> </span>-f<span class=w> </span>deployment.yaml
</span></code></pre></div> <h3 id=creating-yaml-service-specification-file>Creating YAML service specification file</h3> <p>As in the deployment.yaml file, if you have hte extension just type "Service" and the basic configuration will be created.</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-28-1><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a>New-Item<span class=w> </span>-Path<span class=w> </span>.<span class=w> </span>-Name<span class=w> </span><span class=s2>&quot;service.yaml&quot;</span><span class=w> </span>-ItemType<span class=w> </span><span class=s2>&quot;file&quot;</span>
</span><span id=__span-28-2><a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a>kubectl<span class=w> </span>apply<span class=w> </span>-f<span class=w> </span>service.yaml
</span><span id=__span-28-3><a id=__codelineno-28-3 name=__codelineno-28-3 href=#__codelineno-28-3></a>kubectl<span class=w> </span>get<span class=w> </span>svc
</span><span id=__span-28-4><a id=__codelineno-28-4 name=__codelineno-28-4 href=#__codelineno-28-4></a>minikube<span class=w> </span>service<span class=w> </span>k8s-web-hello
</span></code></pre></div> <p><a href=https://github.com/bstashchuk/k8s/blob/main/service.yaml>service.yaml</a></p> <h3 id=delete-all-created-by-the-yaml-files>Delete all created by the YAML files</h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-29-1><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a>kubectl<span class=w> </span>delete<span class=w> </span>-f<span class=w> </span>deployment.yaml<span class=w> </span>-f<span class=w> </span>service.yaml
</span><span id=__span-29-2><a id=__codelineno-29-2 name=__codelineno-29-2 href=#__codelineno-29-2></a>kubectl<span class=w> </span>get<span class=w> </span>deploy
</span><span id=__span-29-3><a id=__codelineno-29-3 name=__codelineno-29-3 href=#__codelineno-29-3></a>kubectl<span class=w> </span>get<span class=w> </span>svc
</span></code></pre></div> <h2 id=7-ngninx-application-with-two-endpoints>7 - Ngninx application with two endpoints</h2> <h3 id=creating-another-web-app-with-two-endpoints>Creating another web app with two endpoints</h3> <p>Make a copy of the "k8s-web-hello" folder and call it "k8s-web-to-nginx"</p> <h3 id=building-custom-docker-image-for-the-second-web-app>Building custom Docker image for the second web app</h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-30-1><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a>npm<span class=w> </span>install<span class=w> </span>node-fetch
</span><span id=__span-30-2><a id=__codelineno-30-2 name=__codelineno-30-2 href=#__codelineno-30-2></a>Remove-Item<span class=w> </span>-Recurse<span class=w> </span>-Force<span class=w> </span>node_modules
</span><span id=__span-30-3><a id=__codelineno-30-3 name=__codelineno-30-3 href=#__codelineno-30-3></a>docker<span class=w> </span>build<span class=w> </span>.<span class=w> </span>-t<span class=w> </span>mitu7/k8s-web-to-nginx
</span><span id=__span-30-4><a id=__codelineno-30-4 name=__codelineno-30-4 href=#__codelineno-30-4></a>docker<span class=w> </span>push<span class=w> </span>mitu7/k8s-web-to-nginx
</span></code></pre></div> <h3 id=creating-yaml-specification-for-the-second-web-app>Creating YAML specification for the second web app</h3> <p>Create the file "k8s-web-to-nginx.yaml" and copy&amp;paste the content of "service.yaml", then add "---" at the end of the file and copy at the end the content of the "deployment.yaml".</p> <h3 id=creating-yaml-specification-for-the-nginx-app>Creating YAML specification for the NGINX app</h3> <p>Create a copy of the file "k8s-web-to-nginx.yaml" and rename it to "nginx.yaml" and edit it to create the nginx deployment and service</p> <h3 id=applying-specifications-for-both-apps>Applying specifications for both apps</h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-31-1><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a>kubectl<span class=w> </span>apply<span class=w> </span>-f<span class=w> </span><span class=s2>&quot;k8s-web-to-nginx.yaml&quot;</span><span class=w> </span>-f<span class=w> </span><span class=s2>&quot;nginx.yaml&quot;</span>
</span><span id=__span-31-2><a id=__codelineno-31-2 name=__codelineno-31-2 href=#__codelineno-31-2></a>kubectl<span class=w> </span>get<span class=w> </span>deploy
</span><span id=__span-31-3><a id=__codelineno-31-3 name=__codelineno-31-3 href=#__codelineno-31-3></a>kubectl<span class=w> </span>get<span class=w> </span>svc
</span><span id=__span-31-4><a id=__codelineno-31-4 name=__codelineno-31-4 href=#__codelineno-31-4></a>kubectl<span class=w> </span>get<span class=w> </span>pods
</span></code></pre></div> <h3 id=verifying-connectivity-between-different-deployments>Verifying connectivity between different deployments</h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-32-1><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a>minikube<span class=w> </span>service<span class=w> </span>k8s-web-to-nginx
</span></code></pre></div> <p>On the new page add "/nginx" at the end</p> <h3 id=resolving-service-name-to-ip-address>Resolving Service name to IP address</h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-33-1><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a>kubectl<span class=w> </span>get<span class=w> </span>pods
</span><span id=__span-33-2><a id=__codelineno-33-2 name=__codelineno-33-2 href=#__codelineno-33-2></a>kubectl<span class=w> </span><span class=nb>exec</span><span class=w> </span>&lt;Pod-name&gt;<span class=w> </span>--<span class=w> </span>nslookup<span class=w> </span>nginx
</span><span id=__span-33-3><a id=__codelineno-33-3 name=__codelineno-33-3 href=#__codelineno-33-3></a>kubectl<span class=w> </span>get<span class=w> </span>svc
</span></code></pre></div> <p>With this command we tried to resolve "nginx" name from inside the container which belongs to that Pod. The IP obtained it came from the nginx service</p> <p>You can also try to retrieve the web page to verify that the connection is established.</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-34-1><a id=__codelineno-34-1 name=__codelineno-34-1 href=#__codelineno-34-1></a>kubectl<span class=w> </span><span class=nb>exec</span><span class=w> </span>&lt;Pod-name&gt;<span class=w> </span>--<span class=w> </span>wget<span class=w> </span>-qO-<span class=w> </span>http://nginx
</span></code></pre></div> <h3 id=deleting-both-applications>Deleting both applications</h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-35-1><a id=__codelineno-35-1 name=__codelineno-35-1 href=#__codelineno-35-1></a>kubectl<span class=w> </span>delete<span class=w> </span>-f<span class=w> </span><span class=s2>&quot;k8s-web-to-nginx.yaml&quot;</span><span class=w> </span>-f<span class=w> </span><span class=s2>&quot;nginx.yaml&quot;</span>
</span></code></pre></div> <h2 id=8-changing-container-runtime-from-docker-to-cri-o>8 - Changing Container Runtime from Docker to CRI-O</h2> <p>Delete current cluster</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-36-1><a id=__codelineno-36-1 name=__codelineno-36-1 href=#__codelineno-36-1></a>minikube<span class=w> </span>status
</span><span id=__span-36-2><a id=__codelineno-36-2 name=__codelineno-36-2 href=#__codelineno-36-2></a>minikube<span class=w> </span>stop
</span><span id=__span-36-3><a id=__codelineno-36-3 name=__codelineno-36-3 href=#__codelineno-36-3></a>minikube<span class=w> </span>delete
</span></code></pre></div> <p>You can use CRI-O or containerd as a container runtime in the K8S cluster. To see if it worked you can connect to the cluster en execute the docker command to see how it fails and then the specific command for the container runtime.</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-37-1><a id=__codelineno-37-1 name=__codelineno-37-1 href=#__codelineno-37-1></a>minikube<span class=w> </span>start<span class=w> </span>--drive<span class=o>=</span>hyperv<span class=w> </span>--container-runtime<span class=o>=</span>cri-o
</span><span id=__span-37-2><a id=__codelineno-37-2 name=__codelineno-37-2 href=#__codelineno-37-2></a><span class=c1>#minikube start --drive=hyperv --container-runtime=containerd</span>
</span><span id=__span-37-3><a id=__codelineno-37-3 name=__codelineno-37-3 href=#__codelineno-37-3></a>minikube<span class=w> </span>status
</span><span id=__span-37-4><a id=__codelineno-37-4 name=__codelineno-37-4 href=#__codelineno-37-4></a>
</span><span id=__span-37-5><a id=__codelineno-37-5 name=__codelineno-37-5 href=#__codelineno-37-5></a>minikube<span class=w> </span>ip
</span><span id=__span-37-6><a id=__codelineno-37-6 name=__codelineno-37-6 href=#__codelineno-37-6></a>ssh<span class=w> </span>docker@&lt;cluster-IP&gt;
</span><span id=__span-37-7><a id=__codelineno-37-7 name=__codelineno-37-7 href=#__codelineno-37-7></a>&gt;<span class=w> </span>tcuser
</span><span id=__span-37-8><a id=__codelineno-37-8 name=__codelineno-37-8 href=#__codelineno-37-8></a>docker<span class=w> </span>ps
</span><span id=__span-37-9><a id=__codelineno-37-9 name=__codelineno-37-9 href=#__codelineno-37-9></a>sudo<span class=w> </span>crictl<span class=w> </span>ps
</span><span id=__span-37-10><a id=__codelineno-37-10 name=__codelineno-37-10 href=#__codelineno-37-10></a>sudo<span class=w> </span>crictl<span class=w> </span>ps<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>k8s-web-to-nginx
</span></code></pre></div> <h3 id=deploying-apps-using-cri-o-container-runtime>Deploying apps using CRI-O container runtime</h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-38-1><a id=__codelineno-38-1 name=__codelineno-38-1 href=#__codelineno-38-1></a>kubectl<span class=w> </span>apply<span class=w> </span>-f<span class=w> </span><span class=s2>&quot;k8s-web-to-nginx.yaml&quot;</span><span class=w> </span>-f<span class=w> </span><span class=s2>&quot;nginx.yaml&quot;</span>
</span></code></pre></div> <h3 id=verifying-connectivity-between-deployments>Verifying connectivity between deployments</h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-39-1><a id=__codelineno-39-1 name=__codelineno-39-1 href=#__codelineno-39-1></a>minikube<span class=w> </span>service<span class=w> </span>k8s-web-to-nginx
</span></code></pre></div> <p>Once the window is open add "/nginx" at the end of the URL.</p> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2023 Marian-Dumitru Danci </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/dumitrux target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </a> <a href=https://twitter.com/dumitruxx target=_blank rel=noopener title=twitter.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </a> <a href=https://www.linkedin.com/in/dumitrux target=_blank rel=noopener title=www.linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <script id=__config type=application/json>{"base": "../..", "features": ["content.action.edit", "content.action.view", "content.code.annotation", "content.code.copy", "content.code.select", "content.tabs.link", "navigation.instant", "navigation.instant.progress", "navigation.path", "navigation.prune", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "search.highlight", "search.suggest", "toc.follow"], "search": "../../assets/javascripts/workers/search.c011b7c0.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../assets/javascripts/bundle.7389ff0e.min.js></script> <script src=https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js></script> <script src=../../javascripts/tablesort.js></script> <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body> </html>